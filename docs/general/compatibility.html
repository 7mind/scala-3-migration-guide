<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Compatibility Reference · Scala 3 Migration guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Scala 3 is a game changer in terms of compatibility in the Scala ecosystem that will greatly improve the day-to-day experience of every Scala programmer, starting from the migration."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Compatibility Reference · Scala 3 Migration guide"/><meta property="og:type" content="website"/><meta property="og:url" content="https://scalacenter.github.io//scala-3-migration-guide/index.html"/><meta property="og:description" content="Scala 3 is a game changer in terms of compatibility in the Scala ecosystem that will greatly improve the day-to-day experience of every Scala programmer, starting from the migration."/><meta property="og:image" content="https://scalacenter.github.io//scala-3-migration-guide/img/scalacenter2x.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://scalacenter.github.io//scala-3-migration-guide/img/scalacenter2x.png"/><link rel="shortcut icon" href="/scala-3-migration-guide/img/dotty-logo.svg"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Fira+Code:400,700&amp;display=fallback"/><script src="/scala-3-migration-guide/js/scrollSpy.js"></script><link rel="stylesheet" href="/scala-3-migration-guide/css/main.css"/><script src="/scala-3-migration-guide/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/scala-3-migration-guide/"><img class="logo" src="/scala-3-migration-guide/img/dotty-logo-white.svg" alt="Scala 3 Migration guide"/><h2 class="headerTitleWithLogo">Scala 3 Migration guide</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive siteNavItemActive"><a href="/scala-3-migration-guide/docs/general/compatibility.html" target="_self">User Guide</a></li><li class=""><a href="/scala-3-migration-guide/docs/contributing.html" target="_self">Contribute</a></li><li class=""><a href="https://github.com/scalacenter/scala-3-migration-guide" target="_blank">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>General</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">General</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/scala-3-migration-guide/docs/general/compatibility.html">Compatibility Reference</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/general/incompatibility-table.html">Incompatibility Table</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/general/metaprogramming.html">Metaprogramming</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tooling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/migration-tools.html">Tour of the Migration Tools</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-migration-mode.html">Scala 3 Migration Mode</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-migrate-plugin.html">Scala 3 Migrate Plugin</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-syntax-rewrites.html">Scala 3 Syntax Rewriting</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/prerequisites.html">Project Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/sbt-migration.html">sbt Migration Tutorial</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/macro-cross-building.html">Cross-Building a Macro Library</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/macro-mixing.html">Mixing Scala 2.13 and Scala 3 Macros</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/scalacoptions-migration.html">Porting the scalacOptions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Incompatibilities</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/syntactic-changes.html">Syntactic Changes</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/dropped-features.html">Dropped Features</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html">Contextual Abstractions</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/other-changed-features.html">Other Changed Features</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/macros/macro-libraries.html">Scala Macro Libraries</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/external-resources/moving-from-scala-2-to-scala-3.html">Moving from Scala 2 to Scala 3</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/scalacenter/scala-3-migration-guide/edit/main/docs/general/compatibility.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Compatibility Reference</h1></header><article><div><span><p>Scala 3 is a game changer in terms of compatibility in the Scala ecosystem that will greatly improve the day-to-day experience of every Scala programmer, starting from the migration.</p>
<p>In this page you will learn about the compatibility between Scala 2.13 and Scala 3 at different stages of the program lifetime.
You will then find out how to benefit from these levels of compatibility in concrete examples of dependencies.</p>
<h2><a class="anchor" aria-hidden="true" id="source-level"></a><a href="#source-level" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source Level</h2>
<p>A large subset of the Scala 2.13 language is still compatible in Scala 3.
Not all of it though, some constructs have been simplified, restricted or dropped altogether.
However those decisions were made for good reasons and by taking care that a good workaround is possible.</p>
<p>In general there is a straightforward cross-compiling solution for every incompatibility, so that the migration from Scala 2.13 to Scala 3 is easy and smooth.
You can find a corpus of incompatibilities in the <a href="/scala-3-migration-guide/docs/general/incompatibility-table.html">next page</a>.</p>
<p>There is an exception though, which is the new metaprogramming framework that replaces the Scala 2 experimental macros.
Further explanations are given down below.</p>
<p>Metaprogramming aside, a Scala 2.13 source code can rather easily be ported to Scala 3.
Once done, you will be able to use the new powerful features of Scala 3, which have no equivalent in Scala 2.
The downside is those sources won't compile in Scala 2.13 anymore.
But amazingly, this new Scala 3 artifact can be consumed as a dependency in Scala 2.13.</p>
<p>As we will see in more detail, it permits forward compatibility on many new features, except the most exotic ones.
This is a breakthrough in the Scala programming history.</p>
<h2><a class="anchor" aria-hidden="true" id="classpath-compatibility"></a><a href="#classpath-compatibility" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Classpath Compatibility</h2>
<p>In your code you can use public types and terms, and call public methods that are defined in a different module or library.
It works well as long as the type checker, which is the compiler phase that validates the semantic consistency of the code, is able to read the signatures of those types, terms and methods, from the class files containing them.</p>
<p>In Scala 2 the signatures are stored in a dedicated format called the Pickle format.
In Scala 3 the story is a bit different because it relies on the TASTy format which is a lot more than a signature layout.
But, for the purpose of migrating from Scala 2.13 to Scala 3, only the signatures are useful.</p>
<h3><a class="anchor" aria-hidden="true" id="the-scala-3-unpicklers"></a><a href="#the-scala-3-unpicklers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Scala 3 Unpicklers</h3>
<p>The first piece of good news is that the Scala 3 compiler is already able to read both formats (the Scala 2.13 Pickle format and the TASTy format) and thus it can type check code that depends on modules or libraries compiled by Scala 2.13 or Scala 3.</p>
<blockquote>
<p>These unpicklers have been extensively tested in the Scala 3 community build. They are safe to use.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="the-scala-213-tasty-reader"></a><a href="#the-scala-213-tasty-reader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Scala 2.13 TASTy Reader</h3>
<p>The second piece of good news is that the Scala 2.13 TASTy reader, which enables consuming Scala 3 libraries in Scala 2.13 has been shipped into Scala <code>2.13.5</code>.</p>
<blockquote>
<p>The TASTy reader is very new. As such it is available under the <code>-Ytasty-reader</code> flag.</p>
</blockquote>
<p>It supports all the traditional constructs as well as the following new features:</p>
<ul>
<li>Enumerations</li>
<li>Intersection types</li>
<li>Opaque type aliases</li>
<li>Type lambdas</li>
<li>New syntax for contextual abstractions</li>
<li>Inheritance of open classes and super traits</li>
<li>Exported definitions</li>
</ul>
<p>We have limited support on:</p>
<ul>
<li>Top level definitions</li>
<li>Extension methods</li>
</ul>
<p>More exotic features are not supported:</p>
<ul>
<li>Context functions</li>
<li>Polymorphic function types</li>
<li>Trait parameters</li>
<li><code>@static</code> annotation</li>
<li><code>@alpha</code> annotation</li>
<li>Functions and Tuples larger than 22 parameters</li>
<li>Reference to <code>scala.Tuple</code> and <code>scala.*:</code></li>
<li>Match types</li>
<li>Union types</li>
<li>Multiversal equality constraints unless explicit</li>
<li>Inline functions (including Scala 3 macros)</li>
<li>Subtype kind polymorphism (upper bound <code>scala.AnyKind</code>)</li>
</ul>
<p>You can have a Scala <code>2.13.5</code> module that depends on a Scala <code>3.0.0-RC2</code> module, and the latter can even depend on another Scala <code>2.13.5</code> module.</p>
<p>In short, we have backward and forward compatibility and so <strong>migration can happen gradually</strong>.
An application can jump to Scala 3 even if its dependencies are not fully ported to Scala 3.</p>
<blockquote>
<p>Using the intercompatibility between 2.13 and 3 is useful during the transition period of an application.</p>
<p>However, it is discouraged to publish a Scala 2.13 library that depends on a Scala 3 library or vice-versa.
The reason is to prevent library users from ending up with two conflicting version <code>foo_2.13</code> and <code>foo_3</code> of the same foo library in their classpath.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="runtime"></a><a href="#runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Runtime</h2>
<p>ABI, which stands for Application Binary Interface, is the representation of Scala code in bytecode or Scala.js IR.
It largely determines the runtime behavior of a piece of code.
Scala 2.13 and Scala 3 share the same ABI.
A piece of code, provided that the inferred types and implicit resolutions are the same, will produce the same bytecode and eventually have the same behavior at runtime.</p>
<p>Sharing the ABI ensures that Scala 2.13 and Scala 3 class files can be loaded by the same JVM class loader, and that Scala 2.13 and Scala 3 <code>sjsir</code> files can be linked together by the Scala.js linker.
Furthermore it relieves us from a lot of surprising behaviors at runtime.
It makes the migration from Scala 2.13 to Scala 3 very safe in terms of runtime crashes and performance.</p>
<h2><a class="anchor" aria-hidden="true" id="metaprogramming"></a><a href="#metaprogramming" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metaprogramming</h2>
<p>A macro definition produces bytecode that will be executed by the compiler.
When you depend on a macro definition, the compiler loads the class file containing it and calls the macro method to produce the bytecode of your program.</p>
<p>The Scala 2.13 macro feature, which was so far available under the <code>-experimental</code> flag, is closely tied to the Scala 2.13 compiler internals.
Therefore it is not possible for the Scala 3 compiler to execute those macros.</p>
<p>In contrast, the Scala 3 macro feature is based on TASTy which is designed for stability and compiler independence.
It will stay compatible with the future versions of the Scala 3 compiler.
But it is not compatible with the Scala 2.13 compiler, which does not fully support TASTy.</p>
<p>The Scala 2.13 macros must be reimplemented with the new Scala 3 metaprogramming feature.
As a macro library author, you can use cross-building to publish for both versions of the language.
This is described in the <a href="/scala-3-migration-guide/docs/tutorials/macro-cross-building.html">Cross-Building Macros</a> tutorial.
An other technique, that is made possible by Scala 3, is described in the <a href="/scala-3-migration-guide/docs/tutorials/macro-mixing.html">Mixing Macros</a> tutorial.
It consists of mixing the Scala 2.13 and Scala 3 macro definitions in the same Scala 3 artifact.</p>
<h2><a class="anchor" aria-hidden="true" id="examples-of-dependencies"></a><a href="#examples-of-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples of Dependencies</h2>
<blockquote>
<p>sbt 1.5.0 or higher is required</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="a-scala-3-module-depending-on-a-scala-213-artifact"></a><a href="#a-scala-3-module-depending-on-a-scala-213-artifact" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Scala 3 module depending on a Scala 2.13 artifact</h3>
<p>A Scala 3 module can depend on a Scala 2.13 artifact.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/3to2.svg" alt="Scala 3 module depending on a Scala 2.13 artifact"></p>
<p>This diagram can be translated into sbt:</p>
<pre><code class="hljs css language-scala">lazy val foo = project.in.file("foo")
  .settings(scalaVersion := "3.0.0-RC2")
  .dependsOn(bar)

lazy val bar = project.in(file("bar"))
  .settings(scalaVersion := "2.13.5)
</code></pre>
<p>Or, in case <code>bar</code> is a published Scala 2.13 library, we can have:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> foo = project.in.file(<span class="hljs-string">"foo"</span>)
  .settings(
    scalaVersion := <span class="hljs-string">"3.0.0-RC2"</span>,
    libraryDependencies += (<span class="hljs-string">"org.bar"</span> %% <span class="hljs-string">"bar"</span> % <span class="hljs-string">"1.0.0"</span>).cross(<span class="hljs-type">CrossVersion</span>.for3Use2_13)
  )
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="the-scala-standard-library"></a><a href="#the-scala-standard-library" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Scala Standard Library</h4>
<p>The official standard library for Scala 3 is the Scala 2.13 library.
Not only is its source code unchanged but it is even not compiled and published under 3.
It could be but it would be useless because, as we have seen, a Scala 3 module can depend on a Scala 2.13 artifact.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/standardlib.svg" alt="Scala 3 library dependency"></p>
<h3><a class="anchor" aria-hidden="true" id="a-scala-213-module-depending-on-a-scala-3-artifact"></a><a href="#a-scala-213-module-depending-on-a-scala-3-artifact" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Scala 2.13 module depending on a Scala 3 artifact</h3>
<p>As of <code>2.13.5</code> a Scala 2.13 module can depend on a Scala 3 library by enabling the Tasty reader with <code>-Ytasty-reader</code>.
<img src="/scala-3-migration-guide/docs/assets/compatibility/2to3.svg" alt="Scala 2 module depending on a Scala 3 artifact"></p>
<p>This diagram can be translated into sbt:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> foo = project.in.file(<span class="hljs-string">"foo"</span>)
  .settings(
    scalaVersion := <span class="hljs-string">"2.13.5"</span>,
    scalacOptions += <span class="hljs-string">"-Ytasty-reader"</span>
  )
  .dependsOn(bar)

<span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> bar = project.in(file(<span class="hljs-string">"bar"</span>))
  .settings(scalaVersion := <span class="hljs-string">"3.0.0-RC2"</span>)
</code></pre>
<p>Or, in case <code>bar</code> is a published Scala 3 library:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> foo = project.in.file(<span class="hljs-string">"foo"</span>)
  .settings(
    scalaVersion := <span class="hljs-string">"3.0.0-RC2"</span>,
    scalacOptions += <span class="hljs-string">"-Ytasty-reader"</span>,
    libraryDependencies += (<span class="hljs-string">"org.bar"</span> %% <span class="hljs-string">"bar"</span> % <span class="hljs-string">"1.0.0"</span>).cross(<span class="hljs-type">CrossVersion</span>.for2_13Use3)
  )
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="macro-dependencies"></a><a href="#macro-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Macro dependencies</h3>
<h4><a class="anchor" aria-hidden="true" id="a-scala-3-module-cannot-depend-on-a-scala-213-macro"></a><a href="#a-scala-3-module-cannot-depend-on-a-scala-213-macro" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Scala 3 module cannot depend on a Scala 2.13 macro</h4>
<p>The Scala 3 compiler cannot execute a macro implemented in a Scala 2.13 artifact.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/3toMacro2.svg" alt="Not working"></p>
<p>But a Scala 3 module can depend on a Scala 2.13 artifact whose compilation has involved a Scala 2.13 macro execution.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/3toMacro2bis.svg" alt="Transitive macro dependency"></p>
<h4><a class="anchor" aria-hidden="true" id="a-scala-213-module-cannot-depend-on-a-scala-3-macro"></a><a href="#a-scala-213-module-cannot-depend-on-a-scala-3-macro" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Scala 2.13 module cannot depend on a Scala 3 macro</h4>
<p>The Scala 2.13 compiler cannot execute a macro implemented in a Scala 3 artifact.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/2toMacro3.svg" alt="Not working"></p>
<p>But a Scala 2.13 module can depend on a Scala 3 artifact whose compilation has involved a Scala 3 macro execution.</p>
<p><img src="/scala-3-migration-guide/docs/assets/compatibility/2toMacro3bis.svg" alt="Transitive macro dependency"></p>
<blockquote>
<p>The macro can be defined inside the Scala 3 module that consumes it.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="a-shared-macro-api-in-a-scala-3-artifact"></a><a href="#a-shared-macro-api-in-a-scala-3-artifact" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A shared macro API in a Scala 3 artifact</h4>
<p>A Scala 3 artifact can bear the declarations of a Scala 3 macro <strong>and</strong> its Scala 2.13 counterpart, next to one another.</p>
<p><img src="../assets/compatibility/sharedMacroAPI.svg" alt="Shared macro API in a Scala 3 artifact"></p>
<p>You can learn this technique in the <a href="/scala-3-migration-guide/docs/tutorials/macro-mixing.html">Mixing Macros</a> tutorial.
Another working example can be found in <a href="https://github.com/scalacenter/mix-macros-scala-2-and-3">this repository</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-next button" href="/scala-3-migration-guide/docs/general/incompatibility-table.html"><span>Incompatibility Table</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#source-level">Source Level</a></li><li><a href="#classpath-compatibility">Classpath Compatibility</a><ul class="toc-headings"><li><a href="#the-scala-3-unpicklers">The Scala 3 Unpicklers</a></li><li><a href="#the-scala-213-tasty-reader">The Scala 2.13 TASTy Reader</a></li></ul></li><li><a href="#runtime">Runtime</a></li><li><a href="#metaprogramming">Metaprogramming</a></li><li><a href="#examples-of-dependencies">Examples of Dependencies</a><ul class="toc-headings"><li><a href="#a-scala-3-module-depending-on-a-scala-213-artifact">A Scala 3 module depending on a Scala 2.13 artifact</a></li><li><a href="#a-scala-213-module-depending-on-a-scala-3-artifact">A Scala 2.13 module depending on a Scala 3 artifact</a></li><li><a href="#macro-dependencies">Macro dependencies</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer" style="background-color:#224951"><section class="sitemap"><a href="/scala-3-migration-guide/" class="nav-home"><img src="/scala-3-migration-guide/img/dotty-logo-white.svg" alt="Scala 3 Migration guide" width="66" height="58"/></a><div><h5>Docs</h5><a href="
                /scala-3-migration-guide/docs/compatibility.html">User Guide</a><a href="
                /scala-3-migration-guide/docs/contributing.html">Contribute</a></div><div><h5>Community</h5><a href="https://gitter.im/scala/center" target="_blank">Chat on Gitter</a><a href="https://users.scala-lang.org/" target="_blank">Discuss on Scala Users</a></div><div><h5>More</h5><a href="https://github.com/scalacenter/scala-3-migration-guide" target="_blank">GitHub</a></div></section><section class="copyright">Copyright © 2021 Scala Center</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f77e0c381ea8939fc6c34dc0e17ea492',
                indexName: 'scala-3-migration-guide',
                inputSelector: '#search_input_react'
              });
            </script></body></html>